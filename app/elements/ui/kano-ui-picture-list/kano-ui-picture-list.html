<link rel="import" href="../behaviors.html">
<link rel="import" href="../../kano-style/part.html">
<link rel="import" href="../../kano-gif-creator/kano-gif-creator.html">
<dom-module id="kano-ui-picture-list">
    <style is="custom-style" include="part-style"></style>
    <style>
    :host {
        display: inline-block;
    }
    .container {
        position: relative;
        width: 320px;
        height: 244px;
    }
    :host(.playing) .container .picture {
        transform: none;
        box-shadow: none;
    }
    :host(.playing) .container .picture .counter {
        display: none;
    }
    :host(.playing) .top {
        display: none;
    }
    :host(.playing) .frame {
        display: block;
    }
    .frame {
        display: none;
    }
    .picture {
        @apply(--shadow-elevation-4dp);
        position: absolute;
        border-radius: 6px;
        border: 2px solid white;
        background-color: lightgrey;
        min-width: 320px;
        min-height: 244px;
        transition: all ease-out 150ms;
    }
    .picture:nth-child(1) {
        transform: rotate(5deg) translate(0px, -7px);
    }
    .picture:nth-child(2) {
        transform: rotate(-3deg) translate(0px, -5px);
    }
    .picture:nth-child(3) {
        transform: rotate(3deg) translate(5px);
    }
    .picture:nth-child(4) {
        transform: rotate(1deg);
        position: relative;
    }
    .container:hover .picture {
        @apply(--shadow-elevation-2dp);
        transform-origin: 20px 80px;
    }
    .container:hover .picture:nth-child(1) {
        transform: rotate(-6deg);
    }
    .container:hover .picture:nth-child(2) {
        transform: rotate(-4deg);
    }
    .container:hover .picture:nth-child(3) {
        transform: rotate(-2deg);
    }
    .container:hover .picture:nth-child(4) {
        transform: rotate(-1deg);
    }
    .counter {
        position: absolute;
        right: 0px;
        top: calc(50% - 11px);
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-justified);
        background-color: rgba(0, 0, 0, 0.45);
        border-top-left-radius: 11px;
        border-bottom-left-radius: 11px;
        color: white;
        width: 40px;
        height: 22px;
        font-size: 14px;
        padding-left: 9px;
        padding-right: 6px;
    }
    kano-gif-creator {
        margin: 7px;
    }
    img {
        width: 11px;
    }
    </style>
    <template>
        <div class="container">
            <div class="picture"></div>
            <div class="picture"></div>
            <div class="picture"></div>
            <div class="picture">
                <kano-gif-creator id="gif-creator" width="[[FRAME_WIDTH]]" height="[[FRAME_HEIGHT]]" pictures="[[pictures]]" framerate="[[model.userProperties.speed]]"></kano-gif-creator>
                <div class="counter">
                    <img src="/assets/part/camera.png" alt="Camera icon"/>
                    <span>[[pictures.length]]</span>
                </div>
            </div>
        </div>
    </template>
</dom-module>

<script type="text/javascript">
    /* globals Polymer, Kano */

    Polymer({
        is: 'kano-ui-picture-list',
        behaviors: [Kano.Behaviors.UIBehavior],
        properties: {
            topPicture: {
                type: String,
                computed: '_computeTopPicture(pictures.*)'
            }
        },
        ready () {
            this.pictures = [];
            this.frameId = 0;
            this.FRAME_WIDTH = 306;
            this.FRAME_HEIGHT = 230;
        },
        attached () {
            this.reset();
        },
        reset () {
            this.$['gif-creator']._paintFrame('/assets/part/picture-list-placeholder.svg');
        },
        stop () {
            Kano.Behaviors.UIBehavior.stop.apply(this, arguments);
            this.pictures = [];
            this.pause();
            this.reset();
        },
        _computeTopPicture () {
            return this.pictures[this.pictures.length - 1];
        },
        play () {
            this.toggleClass('playing', true);
            this.$['gif-creator'].play();
        },
        pause () {
            this.toggleClass('playing', false);
            this.$['gif-creator'].pause();
        },
        setSpeed (speed) {
            this.set('model.userProperties.speed', Math.max(0, Math.min(15, speed)));
        },
        downloadGif () {
            this.$['gif-creator'].downloadGif();
        }
    });
</script>
